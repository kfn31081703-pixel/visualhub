<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API ì„¤ì • ë„ìš°ë¯¸ - MySQL ê´€ë¦¬ì</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            font-size: 2rem;
            color: #1e293b;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .step {
            background: #f8fafc;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border-left: 4px solid #3b82f6;
        }

        .step-number {
            display: inline-block;
            width: 32px;
            height: 32px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            font-weight: bold;
            margin-right: 12px;
        }

        .step h2 {
            display: inline-block;
            font-size: 1.3rem;
            color: #1e293b;
            margin-bottom: 16px;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .result {
            background: #ecfdf5;
            border: 2px solid #10b981;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            display: none;
        }

        .result.error {
            background: #fef2f2;
            border-color: #ef4444;
        }

        .result.show {
            display: block;
        }

        .result h3 {
            color: #065f46;
            margin-bottom: 12px;
        }

        .result.error h3 {
            color: #991b1b;
        }

        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 12px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.success {
            background: #10b981;
        }

        .status-indicator.error {
            background: #ef4444;
        }

        .status-indicator.pending {
            background: #f59e0b;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .alert {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }

        .alert-icon {
            font-size: 1.5rem;
            margin-right: 8px;
        }

        ul {
            margin-left: 20px;
            line-height: 1.8;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ API ì„¤ì • ë„ìš°ë¯¸</h1>
        <p class="subtitle">MySQL ê´€ë¦¬ì API ê²½ë¡œë¥¼ ìë™ìœ¼ë¡œ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤</p>

        <!-- 1ë‹¨ê³„: API ê²½ë¡œ ì…ë ¥ -->
        <div class="step">
            <span class="step-number">1</span>
            <h2>API íŒŒì¼ ê²½ë¡œ í™•ì¸</h2>
            <p style="margin: 16px 0; color: #64748b;">
                api.php íŒŒì¼ì„ ì—…ë¡œë“œí•œ ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
            </p>

            <div class="alert">
                <span class="alert-icon">ğŸ’¡</span>
                <strong>íŒ:</strong> ê°€ë¹„ì•„ FTPì—ì„œ íŒŒì¼ì„ ì—…ë¡œë“œí•œ í´ë” ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”.
            </div>

            <div class="input-group">
                <label>API URL ì…ë ¥</label>
                <input type="text" id="apiUrl" placeholder="ì˜ˆ: https://www.visualhub.co.kr/db_add/api.php" 
                       value="https://www.visualhub.co.kr/db_add/api.php">
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="testConnection()">
                    ğŸ” ì—°ê²° í…ŒìŠ¤íŠ¸
                </button>
                <button class="btn btn-secondary" onclick="tryCommonPaths()">
                    ğŸ“‚ ìë™ ê²½ë¡œ ì°¾ê¸°
                </button>
            </div>

            <div id="testResult" class="result"></div>
        </div>

        <!-- 2ë‹¨ê³„: ì„¤ì • ì ìš© -->
        <div class="step">
            <span class="step-number">2</span>
            <h2>ì„¤ì • íŒŒì¼ ìˆ˜ì •</h2>
            <p style="margin: 16px 0; color: #64748b;">
                ì—°ê²°ì´ ì„±ê³µí•˜ë©´ ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ <strong>js/api.js</strong> íŒŒì¼ì˜ 6ë²ˆì§¸ ì¤„ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
            </p>

            <div class="code-block" id="configCode">
                const API_BASE_URL = 'https://www.visualhub.co.kr/db_add/api.php';
            </div>

            <button class="btn btn-success" onclick="copyCode()">
                ğŸ“‹ ì½”ë“œ ë³µì‚¬
            </button>
        </div>

        <!-- 3ë‹¨ê³„: ìµœì¢… í™•ì¸ -->
        <div class="step">
            <span class="step-number">3</span>
            <h2>ì„¤ì • ì™„ë£Œ í™•ì¸</h2>
            <p style="margin: 16px 0; color: #64748b;">
                js/api.js íŒŒì¼ì„ ìˆ˜ì •í•œ í›„ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì„¸ìš”.
            </p>

            <a href="index.html" class="btn btn-success">
                âœ… ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
            </a>
        </div>

        <div class="footer">
            <p>ë¬¸ì œê°€ ê³„ì†ë˜ë©´ <strong>DEBUGGING.md</strong> íŒŒì¼ì„ ì°¸ê³ í•˜ì„¸ìš”.</p>
        </div>
    </div>

    <script>
        let successUrl = '';

        async function testConnection() {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const resultDiv = document.getElementById('testResult');
            
            if (!apiUrl) {
                showResult(false, 'API URLì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            resultDiv.innerHTML = '<p><span class="status-indicator pending"></span> ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</p>';
            resultDiv.className = 'result show';

            try {
                const testUrl = apiUrl + '?action=test_connection';
                const response = await fetch(testUrl);
                const contentType = response.headers.get('content-type');

                console.log('ì‘ë‹µ ìƒíƒœ:', response.status);
                console.log('Content-Type:', contentType);

                // JSON ì‘ë‹µì¸ì§€ í™•ì¸
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('ì‘ë‹µ ë‚´ìš©:', text.substring(0, 500));
                    
                    if (text.includes('<!DOCTYPE') || text.includes('<html')) {
                        showResult(false, `
                            <h3><span class="status-indicator error"></span> HTML í˜ì´ì§€ê°€ ë°˜í™˜ë˜ì—ˆìŠµë‹ˆë‹¤</h3>
                            <p><strong>ì›ì¸:</strong> PHP íŒŒì¼ì´ ì‹¤í–‰ë˜ì§€ ì•Šê±°ë‚˜ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <ul>
                                <li>api.php íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ì—…ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸</li>
                                <li>íŒŒì¼ ê¶Œí•œ: 644 ë˜ëŠ” 755</li>
                                <li>PHPê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸</li>
                            </ul>
                            <div class="code-block">${text.substring(0, 200).replace(/</g, '&lt;').replace(/>/g, '&gt;')}...</div>
                        `);
                    } else {
                        showResult(false, `
                            <h3><span class="status-indicator error"></span> JSON ì‘ë‹µì´ ì•„ë‹™ë‹ˆë‹¤</h3>
                            <p>ì„œë²„ ì‘ë‹µ: ${text.substring(0, 200)}</p>
                        `);
                    }
                    return;
                }

                const data = await response.json();
                console.log('ì‘ë‹µ ë°ì´í„°:', data);

                if (data.success) {
                    successUrl = apiUrl;
                    updateConfigCode(apiUrl);
                    showResult(true, `
                        <h3><span class="status-indicator success"></span> ì—°ê²° ì„±ê³µ!</h3>
                        <p><strong>ë°ì´í„°ë² ì´ìŠ¤:</strong> ${data.database}</p>
                        <p><strong>ì„œë²„ ì •ë³´:</strong> ${data.server_info || 'N/A'}</p>
                        <p style="margin-top: 16px; color: #059669;">
                            âœ… ì´ URLì´ ì˜¬ë°”ë¦…ë‹ˆë‹¤. ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ js/api.js íŒŒì¼ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
                        </p>
                    `);
                } else {
                    showResult(false, `
                        <h3><span class="status-indicator error"></span> ì—°ê²° ì‹¤íŒ¨</h3>
                        <p><strong>ì˜¤ë¥˜:</strong> ${data.error}</p>
                    `);
                }

            } catch (error) {
                console.error('í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                showResult(false, `
                    <h3><span class="status-indicator error"></span> ì—°ê²° ì‹¤íŒ¨</h3>
                    <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                    <ul>
                        <li>URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”</li>
                        <li>CORS ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”</li>
                        <li>api.php íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”</li>
                    </ul>
                `);
            }
        }

        async function tryCommonPaths() {
            const baseUrls = [
                'https://www.visualhub.co.kr/api.php',
                'https://www.visualhub.co.kr/db_add/api.php',
                'https://www.visualhub.co.kr/sds_db/api.php',
                '/sds_db/api.php',
                './api.php',
                '../api.php',
                '/api.php'
            ];

            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<p><span class="status-indicator pending"></span> ì—¬ëŸ¬ ê²½ë¡œë¥¼ ì‹œë„í•˜ëŠ” ì¤‘...</p>';
            resultDiv.className = 'result show';

            for (const url of baseUrls) {
                try {
                    const testUrl = url + '?action=test_connection';
                    const response = await fetch(testUrl);
                    const contentType = response.headers.get('content-type');

                    if (contentType && contentType.includes('application/json')) {
                        const data = await response.json();
                        if (data.success) {
                            document.getElementById('apiUrl').value = url;
                            successUrl = url;
                            updateConfigCode(url);
                            showResult(true, `
                                <h3><span class="status-indicator success"></span> ê²½ë¡œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!</h3>
                                <p><strong>ë°œê²¬ëœ URL:</strong> ${url}</p>
                                <p><strong>ë°ì´í„°ë² ì´ìŠ¤:</strong> ${data.database}</p>
                                <p style="margin-top: 16px; color: #059669;">
                                    âœ… ìœ„ URLì´ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì„¸ìš”.
                                </p>
                            `);
                            return;
                        }
                    }
                } catch (error) {
                    // ë‹¤ìŒ ê²½ë¡œ ì‹œë„
                    continue;
                }
            }

            showResult(false, `
                <h3><span class="status-indicator error"></span> ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ë‹¤ìŒ ê²½ë¡œë¥¼ ëª¨ë‘ ì‹œë„í–ˆì§€ë§Œ ì—°ê²°í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤:</p>
                <ul>
                    ${baseUrls.map(url => '<li>' + url + '</li>').join('')}
                </ul>
                <p style="margin-top: 16px;"><strong>í•´ê²° ë°©ë²•:</strong></p>
                <ul>
                    <li>api.php íŒŒì¼ì´ FTPì— ì—…ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸</li>
                    <li>íŒŒì¼ì´ ìˆëŠ” ì •í™•í•œ ê²½ë¡œë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥ í›„ í…ŒìŠ¤íŠ¸</li>
                    <li>ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ URL ì ‘ì†í•˜ì—¬ í™•ì¸</li>
                </ul>
            `);
        }

        function showResult(success, message) {
            const resultDiv = document.getElementById('testResult');
            resultDiv.className = 'result show' + (success ? '' : ' error');
            resultDiv.innerHTML = message;
        }

        function updateConfigCode(url) {
            const codeBlock = document.getElementById('configCode');
            codeBlock.textContent = `const API_BASE_URL = '${url}';`;
        }

        function copyCode() {
            const codeBlock = document.getElementById('configCode');
            const text = codeBlock.textContent;

            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\njs/api.js íŒŒì¼ì˜ 6ë²ˆì§¸ ì¤„ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');
            }).catch(err => {
                alert('âŒ ë³µì‚¬ ì‹¤íŒ¨. ì½”ë“œë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•˜ì„¸ìš”.');
                console.error('ë³µì‚¬ ì˜¤ë¥˜:', err);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ URL íŒŒë¼ë¯¸í„° í™•ì¸
        window.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const urlParam = params.get('url');
            if (urlParam) {
                document.getElementById('apiUrl').value = urlParam;
            }
        });
    </script>
</body>
</html>
